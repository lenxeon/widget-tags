{"version":3,"sources":["webpack:///static/js/app.js","webpack:///./src/index.js","webpack:///./src/assets/data.js","webpack:///Tag.vue","webpack:///./src/components/Tag.vue?854f","webpack:///./src/components/Tag.vue"],"names":["webpackJsonp","module","exports","__webpack_require__","_interopRequireDefault","obj","__esModule","default","Object","defineProperty","value","Tag","undefined","_Tag","_Tag2","search","tagName","erro","succ","_matched","i","Math","round","random","j","push","uuid","name","setTimeout","bindTagByName","subjectId","console","log","id","tag","sid","unBindTagById","_stringify","_stringify2","ENTER_KEY","LEFT_KEY","UP_KEY","RIGHT_KEY","DOWN_KEY","_","$","api","props","type","String","width","Number","data","focus","loading","locked","newTag","selectIndex","tags","searchResult","computed","wrapClass","tag-box-wrap","this","autocompleteClass","tag-autocomplete","empty","length","filter","urlBuilder","tagId","methods","addTagHander","e","preventDefault","me","$nextTick","$els","tagInput","blurHander","upSelectHandler","max","downSelectHandler","min","submitHandler","_tagName","trim","bindTag","loadShow","loadHide","load","searchTagHandler","_this","keyCode","filterBinded","arr","result","names","each","index","indexOf","unBindTag","_this2","target","attr","_tags","remove","splice","created","__vue_script__","__vue_template__","options","template"],"mappings":"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","file":"static/js/app.js","sourcesContent":["webpackJsonp([2,0],[\n/* 0 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t'use strict';\n\t\n\tObject.defineProperty(exports, \"__esModule\", {\n\t  value: true\n\t});\n\texports.Tag = undefined;\n\t\n\tvar _Tag = __webpack_require__(10);\n\t\n\tvar _Tag2 = _interopRequireDefault(_Tag);\n\t\n\tfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\t\n\texports.default = _Tag2.default;\n\texports.Tag = _Tag2.default;\n\n/***/ },\n/* 1 */\n/***/ function(module, exports) {\n\n\t'use strict';\n\t\n\tmodule.exports = {\n\t  search: function search(tagName, erro, succ) {\n\t    var _matched = [];\n\t    var i = Math.round(Math.random() * 10);\n\t    if (i < 2 || i > 7) {\n\t      i = 0;\n\t    }\n\t    for (var j = 0; j < i; j++) {\n\t      _matched.push({\n\t        'uuid': '10131' + j,\n\t        'name': tagName + '_0' + j\n\t      });\n\t    }\n\t    setTimeout(function () {\n\t      succ(_matched);\n\t    }, 100);\n\t  },\n\t  bindTagByName: function bindTagByName(subjectId, tagName, erro, succ) {\n\t    console.log(subjectId + '|' + tagName);\n\t    var id = Math.round(Math.random() * 1000);\n\t    var tag = {\n\t      uuid: id,\n\t      name: tagName,\n\t      sid: subjectId\n\t    };\n\t    succ(tag);\n\t  },\n\t  unBindTagById: function unBindTagById(subjectId, tagName, erro, succ) {\n\t    succ();\n\t  }\n\t};\n\n/***/ },\n/* 2 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t'use strict';\n\t\n\tObject.defineProperty(exports, \"__esModule\", {\n\t  value: true\n\t});\n\t\n\tvar _stringify = __webpack_require__(3);\n\t\n\tvar _stringify2 = _interopRequireDefault(_stringify);\n\t\n\tfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\t\n\tvar ENTER_KEY = 13;\n\tvar LEFT_KEY = 37;\n\tvar UP_KEY = 38;\n\tvar RIGHT_KEY = 39;\n\tvar DOWN_KEY = 40;\n\tvar _ = __webpack_require__(8);\n\tvar $ = __webpack_require__(7);\n\tvar api = __webpack_require__(1);\n\texports.default = {\n\t  props: {\n\t    subjectId: {\n\t      type: String,\n\t      default: ''\n\t    },\n\t    width: {\n\t      type: Number,\n\t      default: 500\n\t    }\n\t  },\n\t  data: function data() {\n\t    return {\n\t      focus: false,\n\t      loading: false,\n\t      locked: false,\n\t      newTag: '',\n\t      selectIndex: -1,\n\t      tags: [],\n\t      searchResult: []\n\t    };\n\t  },\n\t\n\t  computed: {\n\t    wrapClass: function wrapClass() {\n\t      return {\n\t        'tag-box-wrap': true,\n\t        'focus': this.focus\n\t      };\n\t    },\n\t    autocompleteClass: function autocompleteClass() {\n\t      return {\n\t        'tag-autocomplete': true,\n\t        'empty': this.searchResult.length === 0 && !this.focus\n\t      };\n\t    }\n\t  },\n\t  filter: {\n\t    urlBuilder: function urlBuilder(tagId) {\n\t      return 'http://www.baidu.com/' + tagId;\n\t    }\n\t  },\n\t\n\t  methods: {\n\t    addTagHander: function addTagHander(e) {\n\t      e.preventDefault();\n\t      var me = this;\n\t      me.focus = true;\n\t      me.$nextTick(function () {\n\t        me.$els.tagInput.focus();\n\t      });\n\t    },\n\t    blurHander: function blurHander(e) {\n\t      this.focus = false;\n\t      e.preventDefault();\n\t    },\n\t    upSelectHandler: function upSelectHandler(e) {\n\t      var me = this;\n\t      me.$els.tagInput.value = this.newTag;\n\t      this.selectIndex = Math.max(this.selectIndex - 1, -1);\n\t      e.preventDefault();\n\t      return false;\n\t    },\n\t    downSelectHandler: function downSelectHandler(e) {\n\t      var me = this;\n\t      me.$els.tagInput.value = this.newTag;\n\t      var length = this.searchResult.length;\n\t      this.selectIndex = Math.min(this.selectIndex + 1, length - 1);\n\t      this.selectIndex = Math.max(this.selectIndex, 0);\n\t      e.preventDefault();\n\t      return false;\n\t    },\n\t    submitHandler: function submitHandler() {\n\t      var _tagName = '';\n\t      if (this.searchResult.length > 0 && this.selectIndex >= 0) {\n\t        var tag = this.searchResult[this.selectIndex];\n\t\n\t        _tagName = tag.name;\n\t      } else {\n\t        _tagName = this.newTag.trim();\n\t      }\n\t      if (_tagName && _tagName.trim().length >= 0) {\n\t        this.bindTag(_tagName);\n\t      }\n\t      this.newTag = '';\n\t      this.searchResult = [];\n\t    },\n\t    loadShow: function loadShow() {\n\t      this.locked = true;\n\t      this.loading = true;\n\t    },\n\t    loadHide: function loadHide() {\n\t      this.locked = false;\n\t      this.loading = false;\n\t    },\n\t    load: function load() {\n\t      var me = this;\n\t      me.loadShow();\n\t    },\n\t    searchTagHandler: function searchTagHandler(e) {\n\t      var _this = this;\n\t\n\t      var keyCode = e.keyCode;\n\t      if (keyCode === UP_KEY || keyCode === LEFT_KEY || keyCode === RIGHT_KEY || keyCode === DOWN_KEY || keyCode === ENTER_KEY) {\n\t        return false;\n\t      }\n\t      var tagName = this.newTag.trim();\n\t      if (tagName.length === 0) {\n\t        return;\n\t      }\n\t      api.search(tagName, function () {}, function (_matched) {\n\t        _this.searchResult = _matched;\n\t        if (_this.searchResult.length > 0) {\n\t          _this.selectIndex = -1;\n\t        } else {\n\t          _this.selectIndex = -1;\n\t        }\n\t      });\n\t    },\n\t    filterBinded: function filterBinded(arr) {\n\t      var result = [];\n\t      arr = arr || [];\n\t      var names = [];\n\t      $.each(this.tags, function (index, tag) {\n\t        names.push(tag.name);\n\t      });\n\t      for (var i = 0; i < arr.length; i++) {\n\t        var tag = arr[i];\n\t        if (names.indexOf(tag.name) === -1) {\n\t          result.push(tag);\n\t        }\n\t      }\n\t      return result;\n\t    },\n\t    bindTag: function bindTag(tagName) {\n\t      var me = this;\n\t\n\t      for (var i = 0; i < this.tags.length; i++) {\n\t        if (this.tags[i].name === tagName) {\n\t          return false;\n\t        }\n\t      }\n\t\n\t      api.bindTagByName(this.subjectId, tagName, function () {}, function (data) {\n\t        console.log((0, _stringify2.default)(data));\n\t        me.tags.push(data);\n\t      });\n\t    },\n\t    unBindTag: function unBindTag(e) {\n\t      var _this2 = this;\n\t\n\t      var tagId = $(e.target).attr('uuid');\n\t      api.unBindTagById(this.subjectId, tagId, function () {}, function () {\n\t        var _tags = _.filter(_this2.tags, function (tag) {\n\t          return tag.uuid + '' !== tagId;\n\t        });\n\t        _this2.tags = _tags;\n\t      });\n\t    },\n\t    remove: function remove(tagId) {\n\t      var me = this;\n\t      for (var i = 0; i < me.tags.length; i++) {\n\t        var tag = me.tags[i];\n\t        if (tag.uuid === tagId) {\n\t          me.tags.splice(i, 1);\n\t        }\n\t      }\n\t    }\n\t  },\n\t  created: function created() {\n\t    console.log(this.subjectId);\n\t    this.load();\n\t  }\n\t};\n\n/***/ },\n/* 3 */,\n/* 4 */,\n/* 5 */,\n/* 6 */\n/***/ function(module, exports) {\n\n\t// removed by extract-text-webpack-plugin\n\n/***/ },\n/* 7 */,\n/* 8 */,\n/* 9 */\n/***/ function(module, exports) {\n\n\tmodule.exports = \" <div class=\\\"tag-box fadeIn ani600\\\" v-bind:style=\\\"{ width: width + 'px' }\\\"> <div :class=wrapClass> <ul class=tags id=tag-list> <li class=item v-for=\\\"tag in tags\\\"> <a v-bind:href=tag.uuid>{{tag.name}}</a> <i v-on:click=unBindTag uuid={{tag.uuid}} class=\\\"fa fa-times fa-1 ml-5\\\"></i> </li> <li class=\\\"item editable\\\"> <input v-on:blur=blurHander v-on:keyup.enter=submitHandler v-on:keyup.up=upSelectHandler v-on:keyup.down=downSelectHandler v-on:keyup=\\\"searchTagHandler | debounce 300\\\" v-model=newTag v-el:tag-input class=tag-input type=text /> <span> </span> <span v-on:click=addTagHander class=\\\"tag-editable-addtag ml-5\\\">添加分类标签 </span> </li> </ul> <div :class=autocompleteClass> <div v-if=\\\"newTag.length==0\\\" class=tag-autocomplete-placeholder> 输入分类标签名称(回车提交) </div> <div v-else> <ul v-if=\\\"searchResult.length>0\\\" class=tag-autocomplete-results> <li v-for=\\\"(index, tag) in searchResult\\\" :tag=tag :class=\\\"{ 'result-item': true, 'active':$index===selectIndex }\\\" tag-id={{tag.uuid}}>{{tag.name}}</li> </ul> <ul v-else class=tag-autocomplete-results> <li class=autocomplete-result-tip>enter 自定义分类</li> </ul> </div> </div> </div> </div> \";\n\n/***/ },\n/* 10 */\n/***/ function(module, exports, __webpack_require__) {\n\n\tvar __vue_script__, __vue_template__\n\t__webpack_require__(6)\n\t__vue_script__ = __webpack_require__(2)\n\t__vue_template__ = __webpack_require__(9)\n\tmodule.exports = __vue_script__ || {}\n\tif (module.exports.__esModule) module.exports = module.exports.default\n\tif (__vue_template__) {\n\t(typeof module.exports === \"function\" ? (module.exports.options || (module.exports.options = {})) : module.exports).template = __vue_template__\n\t}\n\n\n/***/ }\n]);\n\n\n/** WEBPACK FOOTER **\n ** static/js/app.js\n **/","import Tag from './components/Tag.vue'\n// import mixins from './mixins/index'\n\nexport default Tag\n\nexport { Tag }\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/index.js\n **/","module.exports = {\n  search (tagName, erro, succ) {\n    var _matched = []\n    var i = Math.round(Math.random() * 10)\n    if (i < 2 || i > 7) {\n      i = 0\n    }\n    for (var j = 0; j < i; j++) {\n      _matched.push({\n        'uuid': '10131' + j,\n        'name': tagName + '_0' + j\n      })\n    }\n    setTimeout(() => {\n      succ(_matched)\n    }, 100)\n  },\n  bindTagByName (subjectId, tagName, erro, succ) {\n    console.log(subjectId + '|' + tagName)\n    var id = Math.round(Math.random() * 1000)\n    var tag = {\n      uuid: id,\n      name: tagName,\n      sid: subjectId\n    }\n    succ(tag)\n  },\n  unBindTagById (subjectId, tagName, erro, succ) {\n    succ()\n  }\n}\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/assets/data.js\n **/","<template>\n  <div class='tag-box fadeIn ani600' v-bind:style=\"{ width: width + 'px' }\">\n    <div :class='wrapClass'>\n      <ul class='tags' id='tag-list'>\n        <li class='item' v-for='tag in tags'>\n            <a v-bind:href='tag.uuid'>{{tag.name}}</a>\n            <i v-on:click='unBindTag' uuid='{{tag.uuid}}' class='fa fa-times fa-1 ml-5'></i>\n        </li>\n        <li class='item editable'>\n          <input\n              v-on:blur='blurHander'\n              v-on:keyup.enter='submitHandler'\n              v-on:keyup.up='upSelectHandler'\n              v-on:keyup.down='downSelectHandler'\n              v-on:keyup = 'searchTagHandler | debounce 300'\n              v-model='newTag'\n              v-el:tag-input\n              class='tag-input' type='text'/>\n          <span>\n          </span>\n          <span v-on:click='addTagHander'\n            class='tag-editable-addtag ml-5'>添加分类标签\n          </span>\n        </li>\n      </ul>\n      <div :class='autocompleteClass'>\n        <div v-if='newTag.length==0' class='tag-autocomplete-placeholder'>\n          输入分类标签名称(回车提交)\n        </div>\n        <div v-else>\n          <ul v-if='searchResult.length>0' class='tag-autocomplete-results'>\n            <li v-for='(index, tag) in searchResult'\n            :tag=\"tag\"\n            :class=\"{ 'result-item': true, 'active':$index===selectIndex }\"\n            tag-id=\"{{tag.uuid}}\">{{tag.name}}</li>\n          </ul>\n          <ul v-else class='tag-autocomplete-results'>\n            <li class='autocomplete-result-tip'>enter 自定义分类</li>\n          </ul>\n        </div>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script>\nconst ENTER_KEY = 13\nconst LEFT_KEY = 37\nconst UP_KEY = 38\nconst RIGHT_KEY = 39\nconst DOWN_KEY = 40\nconst _ = require('underscore')\nconst $ = require('jquery')\nconst api = require('../assets/data')\nexport default {\n  props: {\n    subjectId: {\n      type: String,\n      default: ''\n    },\n    width: {\n      type: Number,\n      default: 500\n    }\n    // ,\n    // callback: {\n    //   type: Object,\n    //   default: function (o) {\n    //     console.log(o)\n    //   }\n    // }\n  },\n  data () {\n    return {\n      focus: false,\n      loading: false,\n      locked: false,\n      newTag: '',\n      selectIndex: -1,\n      tags: [],\n      searchResult: []\n    }\n  },\n  computed: {\n    wrapClass () {\n      return {\n        'tag-box-wrap': true,\n        'focus': this.focus\n      }\n    },\n    autocompleteClass () {\n      return {\n        'tag-autocomplete': true,\n        'empty': this.searchResult.length === 0 && !this.focus\n      }\n    }\n  },\n  filter: {\n    urlBuilder: function (tagId) {\n      return 'http://www.baidu.com/' + tagId\n    }\n  },\n\n  methods: {\n\n    /**\n     * 点击开始添加\n     */\n    addTagHander (e) {\n      e.preventDefault()\n      var me = this\n      me.focus = true\n      me.$nextTick(function () {\n        me.$els.tagInput.focus()\n      })\n    },\n\n    /**\n     * 失去焦点。\n     */\n    blurHander (e) {\n      this.focus = false\n      e.preventDefault()\n    },\n\n    /**\n     * 向上选择\n     */\n    upSelectHandler (e) {\n      var me = this\n      me.$els.tagInput.value = this.newTag\n      this.selectIndex = Math.max(this.selectIndex - 1, -1)\n      e.preventDefault()\n      return false\n    },\n\n    /**\n     * 向下选择\n     */\n    downSelectHandler (e) {\n      var me = this\n      me.$els.tagInput.value = this.newTag\n      var length = this.searchResult.length\n      this.selectIndex = Math.min(this.selectIndex + 1, length - 1)\n      this.selectIndex = Math.max(this.selectIndex, 0)\n      e.preventDefault()\n      return false\n    },\n\n    /**\n     * 回车，先中一个，或者生成一个新的\n     */\n    submitHandler () {\n      var _tagName = ''\n      if (this.searchResult.length > 0 && this.selectIndex >= 0) {\n        var tag = this.searchResult[this.selectIndex]\n        // console.log('选择已存在的：[' + tag.name + ']')\n        _tagName = tag.name\n      } else {\n        // console.log('生成新的：[' + this.newTag.trim() + ']')\n        _tagName = this.newTag.trim()\n      }\n      if (_tagName && _tagName.trim().length >= 0) {\n        this.bindTag(_tagName)\n      }\n      this.newTag = ''\n      this.searchResult = []\n    },\n\n    loadShow () {\n      this.locked = true\n      this.loading = true\n    },\n\n    loadHide () {\n      this.locked = false\n      this.loading = false\n    },\n\n    load () {\n      var me = this\n      me.loadShow()\n      // timer = setTimeout(function () {\n      //   me.loadHide()\n      // }, 3000)\n      // $.ajax({\n      //   type: 'GET',\n      //   dataType: 'json',\n      //   // async: false,\n      //   url: globalConf.contextPath + '/api/v1/tags.json?subjectId=' + subjectId,\n      //   xhrFields: {\n      //     withCredentials: true\n      //   },\n      //   crossDomain: true,\n      //   contentType: 'application/x-www-form-urlencoded charset=utf-8',\n      //   erro () {\n      //     me.loadHide()\n      //     clearTimeout(timer)\n      //   },\n      //   success (resp) {\n      //     clearTimeout(timer)\n      //     me.loadHide()\n      //     me.tags = resp.tags || []\n      //   }\n      // })\n    },\n    searchTagHandler (e) {\n      // var me = this\n      var keyCode = e.keyCode\n      if (keyCode === UP_KEY || keyCode === LEFT_KEY || keyCode === RIGHT_KEY ||\n        keyCode === DOWN_KEY || keyCode === ENTER_KEY) {\n        return false\n      }\n      var tagName = this.newTag.trim()\n      if (tagName.length === 0) {\n        return\n      }\n      api.search(tagName, () => {\n\n      }, (_matched) => {\n        this.searchResult = _matched\n        if (this.searchResult.length > 0) {\n          this.selectIndex = -1\n        } else {\n          this.selectIndex = -1\n        }\n      })\n    },\n    filterBinded (arr) {\n      var result = []\n      arr = arr || []\n      var names = []\n      $.each(this.tags, function (index, tag) {\n        names.push(tag.name)\n      })\n      for (var i = 0; i < arr.length; i++) {\n        var tag = arr[i]\n        if (names.indexOf(tag.name) === -1) {\n          result.push(tag)\n        }\n      }\n      return result\n    },\n\n    /**\n     * 绑定tag\n     */\n    bindTag (tagName) {\n      var me = this\n      // 检查是否已经添加过了\n      for (var i = 0; i < this.tags.length; i++) {\n        if (this.tags[i].name === tagName) {\n          return false\n        }\n      }\n\n      api.bindTagByName(this.subjectId, tagName, () => {\n        // 失败\n      }, (data) => {\n        // 成功\n        console.log(JSON.stringify(data))\n        me.tags.push(data)\n      })\n    },\n\n    /**\n     * un绑定tag\n     */\n    unBindTag (e) {\n      // var me = this\n      var tagId = $(e.target).attr('uuid')\n      api.unBindTagById(this.subjectId, tagId, () => {\n\n      }, () => {\n        var _tags = _.filter(this.tags, (tag) => {\n          return (tag.uuid + '') !== tagId\n        })\n        this.tags = _tags\n      })\n    },\n\n    /**\n     * 从数组中清除tag\n     */\n    remove (tagId) {\n      var me = this\n      for (var i = 0; i < me.tags.length; i++) {\n        var tag = me.tags[i]\n        if (tag.uuid === tagId) {\n          me.tags.splice(i, 1)\n        }\n      }\n    }\n  },\n  created () {\n    console.log(this.subjectId)\n    this.load()\n  }\n}\n</script>\n\n<style lang=\"less\">\n\n@border-color:   #eee;\n@pl:   5px;\n@pr:   18px;\n\n.tag-box {\n  position: relative;\n  width: 100%;\n  &.loaded{\n    .spinner{\n      display: none;\n    }\n  }\n  .tag-box-wrap {\n    border: 1px solid rgba(187, 187, 187, 0);\n\n    .tags {\n      zoom: 1;\n      overflow: hidden;\n      margin: 0;\n      padding: 3px 4px 0;\n\n      .item {\n        position: relative;\n        line-height: 20px;\n        -moz-border-radius: 3px;\n        -webkit-border-radius: 3px;\n        border-radius: 3px;\n        border: 1px solid @border-color;\n        cursor: default;\n        list-style-type: none;\n        float: left;\n        display: block;\n        margin: 0 5px 0px 0;\n        cursor: default;\n        max-width: 100px;\n        overflow: hidden;\n        text-overflow: ellipsis;\n        white-space: nowrap;\n        font-size: 10px;\n        background-color: #f3f3f4;\n        padding: 1px @pr 1px @pl;\n        color: inherit;\n        border: 1px solid #e7eaec;\n        margin-right: 5px;\n        margin-top: 5px;\n        display: block;\n\n        &.editable {\n          border: 0 solid #fff;\n          max-width: auto;\n          background-color: transparent;\n          padding: 0px 0px;\n        }\n        a {\n          cursor: pointer;\n          color: inherit;\n          text-decoration: none;\n        }\n        .fa-times {\n          position: absolute;\n          display: block;\n          cursor: pointer;\n          color: #999;\n          right: 5px;\n          top: 5px;\n        }\n        .tag-input {\n          border: 1px solid #ddd;\n          padding: 1px @pl 1px @pl;\n          line-height: 20px;\n          font-size: 11px;\n          box-shadow: none;\n          width: 50px;\n          display: none;\n          background-color: #fff;\n          background-image: none;\n          border-radius: 4px;\n          -webkit-box-shadow: inset 0 1px 1px rgba(0,0,0,.075);\n          box-shadow: inset 0 1px 1px rgba(0,0,0,.075);\n          -webkit-transition: border-color ease-in-out .15s,-webkit-box-shadow ease-in-out .15s;\n          -o-transition: border-color ease-in-out .15s,box-shadow ease-in-out .15s;\n          transition: border-color ease-in-out .15s,box-shadow ease-in-out .15s;\n          &:focus{\n            border: 1px solid #ccc;\n            outline: none;\n          }\n        }\n        .tag-editable-addtag {\n          cursor: pointer;\n          display: inline-block;\n          color: inherit;\n          vertical-align: middle;\n          line-height: 26px;\n        }\n      }\n    }\n    .tag-autocomplete {\n      position: absolute;\n      left: 0;\n      right: 0;\n      z-index: 288;\n      font-size: 12px;\n      padding-top: 4px;\n      background: #ffffff;\n\n      &.empty{\n        display: none;\n      }\n\n      .tag-autocomplete-placeholder {\n        border-top: none;\n        display: none;\n        background: #F9F9F9;\n        filter: alpha(opacity=98);\n        opacity: .98;\n        webkit-box-shadow: 0 3px 3px @border-color;\n        moz-box-shadow: 0 3px 3px @border-color;\n        box-shadow: 0 3px 3px @border-color;\n        padding: 10px 7px 7px;\n      }\n    }\n    .tag-autocomplete-results {\n      border-top: none;\n      font-size: 12px;\n      display: none;\n      background: #F9F9F9;\n      filter: alpha(opacity=98);\n      opacity: .98;\n      webkit-box-shadow: 0 3px 3px @border-color;\n      moz-box-shadow: 0 3px 3px @border-color;\n      box-shadow: 0 3px 3px @border-color;\n\n      .autocomplete-result-tip {\n        padding: 10px 7px 7px;\n        background: #F9F9F9;\n        filter: alpha(opacity=98);\n        opacity: .98;\n        list-style-type: none;\n        cursor: default;\n      }\n      .result-item {\n        margin: 0;\n        padding: 10px 7px 7px;\n        list-style-type: none;\n        box-sizing: border-bottom;\n        overflow: hidden;\n        text-overflow: ellipsis;\n        white-space: nowrap;\n        display: block;\n        cursor: pointer;\n\n        &.active,&:hover {\n          background: rgba(0, 125, 219, 0.1);\n        }\n      }\n    }\n    .tag-autocomplete-results {\n      padding-right: 0;\n      padding-left: 0;\n      padding-bottom: 0;\n      margin: 0;\n      padding-top: 0;\n    }\n  }\n  .focus {\n    border: 1px solid @border-color;\n\n    .tag-input {\n      display: inline-block !important;\n    }\n    .tag-editable-addtag {\n      display: none !important;\n    }\n    .tag-autocomplete{\n      border: 1px solid @border-color;\n      border-top: none;\n    }\n    .tag-autocomplete-placeholder{\n      display: block !important;\n    }\n    .tag-autocomplete-results{\n      display: block !important;\n    }\n  }\n}\n</style>\n\n\n/** WEBPACK FOOTER **\n ** Tag.vue?cae58766\n **/","module.exports = \" <div class=\\\"tag-box fadeIn ani600\\\" v-bind:style=\\\"{ width: width + 'px' }\\\"> <div :class=wrapClass> <ul class=tags id=tag-list> <li class=item v-for=\\\"tag in tags\\\"> <a v-bind:href=tag.uuid>{{tag.name}}</a> <i v-on:click=unBindTag uuid={{tag.uuid}} class=\\\"fa fa-times fa-1 ml-5\\\"></i> </li> <li class=\\\"item editable\\\"> <input v-on:blur=blurHander v-on:keyup.enter=submitHandler v-on:keyup.up=upSelectHandler v-on:keyup.down=downSelectHandler v-on:keyup=\\\"searchTagHandler | debounce 300\\\" v-model=newTag v-el:tag-input class=tag-input type=text /> <span> </span> <span v-on:click=addTagHander class=\\\"tag-editable-addtag ml-5\\\">添加分类标签 </span> </li> </ul> <div :class=autocompleteClass> <div v-if=\\\"newTag.length==0\\\" class=tag-autocomplete-placeholder> 输入分类标签名称(回车提交) </div> <div v-else> <ul v-if=\\\"searchResult.length>0\\\" class=tag-autocomplete-results> <li v-for=\\\"(index, tag) in searchResult\\\" :tag=tag :class=\\\"{ 'result-item': true, 'active':$index===selectIndex }\\\" tag-id={{tag.uuid}}>{{tag.name}}</li> </ul> <ul v-else class=tag-autocomplete-results> <li class=autocomplete-result-tip>enter 自定义分类</li> </ul> </div> </div> </div> </div> \";\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./~/vue-html-loader!./~/vue-loader/lib/selector.js?type=template&index=0!./src/components/Tag.vue\n ** module id = 9\n ** module chunks = 2\n **/","var __vue_script__, __vue_template__\nrequire(\"!!./../../node_modules/extract-text-webpack-plugin/loader.js?{\\\"omit\\\":1,\\\"extract\\\":true,\\\"remove\\\":true}!vue-style-loader!css-loader?sourceMap!./../../node_modules/vue-loader/lib/style-rewriter.js!less-loader?sourceMap!./../../node_modules/vue-loader/lib/selector.js?type=style&index=0!./Tag.vue\")\n__vue_script__ = require(\"!!babel-loader?presets[]=es2015&plugins[]=transform-runtime&comments=false!./../../node_modules/vue-loader/lib/selector.js?type=script&index=0!./Tag.vue\")\n__vue_template__ = require(\"!!vue-html-loader!./../../node_modules/vue-loader/lib/selector.js?type=template&index=0!./Tag.vue\")\nmodule.exports = __vue_script__ || {}\nif (module.exports.__esModule) module.exports = module.exports.default\nif (__vue_template__) {\n(typeof module.exports === \"function\" ? (module.exports.options || (module.exports.options = {})) : module.exports).template = __vue_template__\n}\n\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./src/components/Tag.vue\n ** module id = 10\n ** module chunks = 2\n **/"],"sourceRoot":""}